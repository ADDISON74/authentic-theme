(function(b){if(typeof exports=="object"&&typeof module=="object"){b(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],b)}else{b(CodeMirror)}}})(function(b){b.defineMode("velocity",function(){function q(e){var c={},f=e.split(" ");for(var d=0;d<f.length;++d){c[f[d]]=true}return c}var o=q("#end #else #break #stop #[[ #]] #{end} #{else} #{break} #{stop}");var p=q("#if #elseif #foreach #set #include #parse #macro #define #evaluate #{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}");var m=q("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent.count $foreach.parent.hasNext $foreach.parent.first $foreach.parent.last $foreach.parent $velocityCount $!bodyContent $bodyContent");var s=/[+\-*&%=<>!?:\/|]/;function t(e,c,d){c.tokenize=d;return d(e,c)}function r(e,g){var c=g.beforeParams;g.beforeParams=false;var d=e.next();if((d=="'")&&!g.inString&&g.inParams){g.lastTokenWasBuiltin=false;return t(e,g,a(d))}else{if((d=='"')){g.lastTokenWasBuiltin=false;if(g.inString){g.inString=false;return"string"}else{if(g.inParams){return t(e,g,a(d))}}}else{if(/[\[\]{}\(\),;\.]/.test(d)){if(d=="("&&c){g.inParams=true}else{if(d==")"){g.inParams=false;g.lastTokenWasBuiltin=true}}return null}else{if(/\d/.test(d)){g.lastTokenWasBuiltin=false;e.eatWhile(/[\w\.]/);return"number"}else{if(d=="#"&&e.eat("*")){g.lastTokenWasBuiltin=false;return t(e,g,n)}else{if(d=="#"&&e.match(/ *\[ *\[/)){g.lastTokenWasBuiltin=false;return t(e,g,l)}else{if(d=="#"&&e.eat("#")){g.lastTokenWasBuiltin=false;e.skipToEnd();return"comment"}else{if(d=="$"){e.eatWhile(/[\w\d\$_\.{}]/);if(m&&m.propertyIsEnumerable(e.current())){return"keyword"}else{g.lastTokenWasBuiltin=true;g.beforeParams=true;return"builtin"}}else{if(s.test(d)){g.lastTokenWasBuiltin=false;e.eatWhile(s);return"operator"}else{e.eatWhile(/[\w\$_{}@]/);var f=e.current();if(o&&o.propertyIsEnumerable(f)){return"keyword"}if(p&&p.propertyIsEnumerable(f)||(e.current().match(/^#@?[a-z0-9_]+ *$/i)&&e.peek()=="(")&&!(p&&p.propertyIsEnumerable(f.toLowerCase()))){g.beforeParams=true;g.lastTokenWasBuiltin=false;return"keyword"}if(g.inString){g.lastTokenWasBuiltin=false;return"string"}if(e.pos>f.length&&e.string.charAt(e.pos-f.length-1)=="."&&g.lastTokenWasBuiltin){return"builtin"}g.lastTokenWasBuiltin=false;return null}}}}}}}}}}function a(c){return function(e,g){var f=false,h,d=false;while((h=e.next())!=null){if((h==c)&&!f){d=true;break}if(c=='"'&&e.peek()=="$"&&!f){g.inString=true;d=true;break}f=!f&&h=="\\"}if(d){g.tokenize=r}return"string"}}function n(e,f){var d=false,c;while(c=e.next()){if(c=="#"&&d){f.tokenize=r;break}d=(c=="*")}return"comment"}function l(e,f){var d=0,c;while(c=e.next()){if(c=="#"&&d==2){f.tokenize=r;break}if(c=="]"){d++}else{if(c!=" "){d=0}}}return"meta"}return{startState:function(){return{tokenize:r,beforeParams:false,inParams:false,inString:false,lastTokenWasBuiltin:false}},token:function(c,d){if(c.eatSpace()){return null}return d.tokenize(c,d)},blockCommentStart:"#*",blockCommentEnd:"*#",lineComment:"##",fold:"velocity"}});b.defineMIME("text/velocity","velocity")});