(function(b){if(typeof exports=="object"&&typeof module=="object"){b(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],b)}else{b(CodeMirror)}}})(function(b){b.defineMode("crystal",function(O){function H(c,d){return new RegExp((d?"":"^")+"(?:"+c.join("|")+")"+(d?"$":"\\b"))}function N(c,d,e){e.tokenize.push(c);return c(d,e)}var I=/^(?:[-+/%|&^]|\*\*?|[<>]{2})/;var X=/^(?:[=!]~|===|<=>|[<>=!]=?|[|&]{2}|~)/;var G=/^(?:\[\][?=]?)/;var R=/^(?:\.(?:\.{2})?|->|[?:])/;var U=/^[a-z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var T=/^[A-Z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var Y=H(["abstract","alias","as","asm","begin","break","case","class","def","do","else","elsif","end","ensure","enum","extend","for","fun","if","include","instance_sizeof","lib","macro","module","next","of","out","pointerof","private","protected","rescue","return","require","select","sizeof","struct","super","then","type","typeof","uninitialized","union","unless","until","when","while","with","yield","__DIR__","__END_LINE__","__FILE__","__LINE__"]);var ad=H(["true","false","nil","self"]);var V=["def","fun","macro","class","module","struct","lib","enum","union","do","for"];var ae=H(V);var L=["if","unless","case","while","until","begin","then"];var P=H(L);var K=["end","else","elsif","rescue","ensure"];var af=H(K);var ac=["\\)","\\}","\\]"];var S=new RegExp("^(?:"+ac.join("|")+")$");var W={def:Z,fun:Z,macro:E,"class":Q,module:Q,struct:Q,lib:Q,"enum":Q,union:Q};var ab={"[":"]","{":"}","(":")","<":">"};function M(d,f){if(d.eatSpace()){return null}if(f.lastToken!="\\"&&d.match("{%",false)){return N(a("%","%"),d,f)}if(f.lastToken!="\\"&&d.match("{{",false)){return N(a("{","}"),d,f)}if(d.peek()=="#"){d.skipToEnd();return"comment"}var h;if(d.match(U)){d.eat(/[?!]/);h=d.current();if(d.eat(":")){return"atom"}else{if(f.lastToken=="."){return"property"}else{if(Y.test(h)){if(ae.test(h)){if(!(h=="fun"&&f.blocks.indexOf("lib")>=0)&&!(h=="def"&&f.lastToken=="abstract")){f.blocks.push(h);f.currentIndent+=1}}else{if((f.lastStyle=="operator"||!f.lastStyle)&&P.test(h)){f.blocks.push(h);f.currentIndent+=1}else{if(h=="end"){f.blocks.pop();f.currentIndent-=1}}}if(W.hasOwnProperty(h)){f.tokenize.push(W[h])}return"keyword"}else{if(ad.test(h)){return"atom"}}}}return"variable"}if(d.eat("@")){if(d.peek()=="["){return N(J("[","]","meta"),d,f)}d.eat("@");d.match(U)||d.match(T);return"variable-2"}if(d.match(T)){return"tag"}if(d.eat(":")){if(d.eat('"')){return N(F('"',"atom",false),d,f)}else{if(d.match(U)||d.match(T)||d.match(I)||d.match(X)||d.match(G)){return"atom"}}d.eat(":");return"operator"}if(d.eat('"')){return N(F('"',"string",true),d,f)}if(d.peek()=="%"){var g="string";var c=true;var e;if(d.match("%r")){g="string-2";e=d.next()}else{if(d.match("%w")){c=false;e=d.next()}else{if(d.match("%q")){c=false;e=d.next()}else{if(e=d.match(/^%([^\w\s=])/)){e=e[1]}else{if(d.match(/^%[a-zA-Z0-9_\u009F-\uFFFF]*/)){return"meta"}else{return"operator"}}}}}if(ab.hasOwnProperty(e)){e=ab[e]}return N(F(e,g,c),d,f)}if(h=d.match(/^<<-('?)([A-Z]\w*)\1/)){return N(aa(h[2],!h[1]),d,f)}if(d.eat("'")){d.match(/^(?:[^']|\\(?:[befnrtv0'"]|[0-7]{3}|u(?:[0-9a-fA-F]{4}|\{[0-9a-fA-F]{1,6}\})))/);d.eat("'");return"atom"}if(d.eat("0")){if(d.eat("x")){d.match(/^[0-9a-fA-F]+/)}else{if(d.eat("o")){d.match(/^[0-7]+/)}else{if(d.eat("b")){d.match(/^[01]+/)}}}return"number"}if(d.eat(/^\d/)){d.match(/^\d*(?:\.\d+)?(?:[eE][+-]?\d+)?/);return"number"}if(d.match(I)){d.eat("=");return"operator"}if(d.match(X)||d.match(R)){return"operator"}if(h=d.match(/[({[]/,false)){h=h[0];return N(J(h,ab[h],null),d,f)}if(d.eat("\\")){d.next();return"meta"}d.next();return null}function J(c,e,d,f){return function(g,h){if(!f&&g.match(c)){h.tokenize[h.tokenize.length-1]=J(c,e,d,true);h.currentIndent+=1;return d}var i=M(g,h);if(g.current()===e){h.tokenize.pop();h.currentIndent-=1;i=d}return i}}function a(c,d,e){return function(f,g){if(!e&&f.match("{"+c)){g.currentIndent+=1;g.tokenize[g.tokenize.length-1]=a(c,d,true);return"meta"}if(f.match(d+"}")){g.currentIndent-=1;g.tokenize.pop();return"meta"}return M(f,g)}}function E(c,d){if(c.eatSpace()){return null}var e;if(e=c.match(U)){if(e=="def"){return"keyword"}c.eat(/[?!]/)}d.tokenize.pop();return"def"}function Z(c,d){if(c.eatSpace()){return null}if(c.match(U)){c.eat(/[!?]/)}else{c.match(I)||c.match(X)||c.match(G)}d.tokenize.pop();return"def"}function Q(c,d){if(c.eatSpace()){return null}c.match(T);d.tokenize.pop();return"def"}function F(e,d,c){return function(f,h){var g=false;while(f.peek()){if(!g){if(f.match("{%",false)){h.tokenize.push(a("%","%"));return d}if(f.match("{{",false)){h.tokenize.push(a("{","}"));return d}if(c&&f.match("#{",false)){h.tokenize.push(J("#{","}","meta"));return d}var i=f.next();if(i==e){h.tokenize.pop();return d}g=c&&i=="\\"}else{f.next();g=false}}return d}}function aa(d,c){return function(e,g){if(e.sol()){e.eatSpace();if(e.match(d)){g.tokenize.pop();return"string"}}var f=false;while(e.peek()){if(!f){if(e.match("{%",false)){g.tokenize.push(a("%","%"));return"string"}if(e.match("{{",false)){g.tokenize.push(a("{","}"));return"string"}if(c&&e.match("#{",false)){g.tokenize.push(J("#{","}","meta"));return"string"}f=c&&e.next()=="\\"}else{e.next();f=false}}return"string"}}return{startState:function(){return{tokenize:[M],currentIndent:0,lastToken:null,lastStyle:null,blocks:[]}},token:function(c,d){var e=d.tokenize[d.tokenize.length-1](c,d);var f=c.current();if(e&&e!="comment"){d.lastToken=f;d.lastStyle=e}return e},indent:function(c,d){d=d.replace(/^\s*(?:\{%)?\s*|\s*(?:%\})?\s*$/g,"");if(af.test(d)||S.test(d)){return O.indentUnit*(c.currentIndent-1)}return O.indentUnit*c.currentIndent},fold:"indent",electricInput:H(ac.concat(K),true),lineComment:"#"}});b.defineMIME("text/x-crystal","crystal")});