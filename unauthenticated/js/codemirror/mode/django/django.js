(function(b){if(typeof exports=="object"&&typeof module=="object"){b(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../../addon/mode/overlay"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed","../../addon/mode/overlay"],b)}else{b(CodeMirror)}}})(function(b){b.defineMode("django:inner",function(){var o=["block","endblock","for","endfor","true","false","filter","endfilter","loop","none","self","super","if","elif","endif","as","else","import","with","endwith","without","context","ifequal","endifequal","ifnotequal","endifnotequal","extends","include","load","comment","endcomment","empty","url","static","trans","blocktrans","endblocktrans","now","regroup","lorem","ifchanged","endifchanged","firstof","debug","cycle","csrf_token","autoescape","endautoescape","spaceless","endspaceless","ssi","templatetag","verbatim","endverbatim","widthratio"],t=["add","addslashes","capfirst","center","cut","date","default","default_if_none","dictsort","dictsortreversed","divisibleby","escape","escapejs","filesizeformat","first","floatformat","force_escape","get_digit","iriencode","join","last","length","length_is","linebreaks","linebreaksbr","linenumbers","ljust","lower","make_list","phone2numeric","pluralize","pprint","random","removetags","rjust","safe","safeseq","slice","slugify","stringformat","striptags","time","timesince","timeuntil","title","truncatechars","truncatechars_html","truncatewords","truncatewords_html","unordered_list","upper","urlencode","urlize","urlizetrunc","wordcount","wordwrap","yesno"],q=["==","!=","<",">","<=",">="],n=["in","not","or","and"];o=new RegExp("^\\b("+o.join("|")+")\\b");t=new RegExp("^\\b("+t.join("|")+")\\b");q=new RegExp("^\\b("+q.join("|")+")\\b");n=new RegExp("^\\b("+n.join("|")+")\\b");function r(c,d){if(c.match("{{")){d.tokenize=m;return"tag"}else{if(c.match("{%")){d.tokenize=s;return"tag"}else{if(c.match("{#")){d.tokenize=l;return"comment"}}}while(c.next()!=null&&!c.match(/\{[{%#]/,false)){}return null}function p(c,d){return function(e,f){if(!f.escapeNext&&e.eat(c)){f.tokenize=d}else{if(f.escapeNext){f.escapeNext=false}var g=e.next();if(g=="\\"){f.escapeNext=true}}return"string"}}function m(c,d){if(d.waitDot){d.waitDot=false;if(c.peek()!="."){return"null"}if(c.match(/\.\W+/)){return"error"}else{if(c.eat(".")){d.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}}if(d.waitPipe){d.waitPipe=false;if(c.peek()!="|"){return"null"}if(c.match(/\.\W+/)){return"error"}else{if(c.eat("|")){d.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}}if(d.waitProperty){d.waitProperty=false;if(c.match(/\b(\w+)\b/)){d.waitDot=true;d.waitPipe=true;return"property"}}if(d.waitFilter){d.waitFilter=false;if(c.match(t)){return"variable-2"}}if(c.eatSpace()){d.waitProperty=false;return"null"}if(c.match(/\b\d+(\.\d+)?\b/)){return"number"}if(c.match("'")){d.tokenize=p("'",d.tokenize);return"string"}else{if(c.match('"')){d.tokenize=p('"',d.tokenize);return"string"}}if(c.match(/\b(\w+)\b/)&&!d.foundVariable){d.waitDot=true;d.waitPipe=true;return"variable"}if(c.match("}}")){d.waitProperty=null;d.waitFilter=null;d.waitDot=null;d.waitPipe=null;d.tokenize=r;return"tag"}c.next();return"null"}function s(e,c){if(c.waitDot){c.waitDot=false;if(e.peek()!="."){return"null"}if(e.match(/\.\W+/)){return"error"}else{if(e.eat(".")){c.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}}if(c.waitPipe){c.waitPipe=false;if(e.peek()!="|"){return"null"}if(e.match(/\.\W+/)){return"error"}else{if(e.eat("|")){c.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}}if(c.waitProperty){c.waitProperty=false;if(e.match(/\b(\w+)\b/)){c.waitDot=true;c.waitPipe=true;return"property"}}if(c.waitFilter){c.waitFilter=false;if(e.match(t)){return"variable-2"}}if(e.eatSpace()){c.waitProperty=false;return"null"}if(e.match(/\b\d+(\.\d+)?\b/)){return"number"}if(e.match("'")){c.tokenize=p("'",c.tokenize);return"string"}else{if(e.match('"')){c.tokenize=p('"',c.tokenize);return"string"}}if(e.match(q)){return"operator"}if(e.match(n)){return"keyword"}var d=e.match(o);if(d){if(d[0]=="comment"){c.blockCommentTag=true}return"keyword"}if(e.match(/\b(\w+)\b/)){c.waitDot=true;c.waitPipe=true;return"variable"}if(e.match("%}")){c.waitProperty=null;c.waitFilter=null;c.waitDot=null;c.waitPipe=null;if(c.blockCommentTag){c.blockCommentTag=false;c.tokenize=a}else{c.tokenize=r}return"tag"}e.next();return"null"}function l(c,d){if(c.match(/^.*?#\}/)){d.tokenize=r}else{c.skipToEnd()}return"comment"}function a(c,d){if(c.match(/\{%\s*endcomment\s*%\}/,false)){d.tokenize=s;c.match("{%");return"tag"}else{c.next();return"comment"}}return{startState:function(){return{tokenize:r}},token:function(c,d){return d.tokenize(c,d)},blockCommentStart:"{% comment %}",blockCommentEnd:"{% endcomment %}"}});b.defineMode("django",function(a){var e=b.getMode(a,"text/html");var f=b.getMode(a,"django:inner");return b.overlayMode(e,f)});b.defineMIME("text/x-django","django")});