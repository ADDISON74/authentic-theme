(function(b){if(typeof exports=="object"&&typeof module=="object"){b(require("../../lib/codemirror"),require("../javascript/javascript"),require("../css/css"),require("../htmlmixed/htmlmixed"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../javascript/javascript","../css/css","../htmlmixed/htmlmixed"],b)}else{b(CodeMirror)}}})(function(b){b.defineMode("pug",function(an){var ax="keyword";var ac="meta";var aA="builtin";var aG="qualifier";var aa={"{":"}","(":")","[":"]"};var aM=b.getMode(an,"javascript");function al(){this.javaScriptLine=false;this.javaScriptLineExcludesColon=false;this.javaScriptArguments=false;this.javaScriptArgumentsDepth=0;this.isInterpolating=false;this.interpolationNesting=0;this.jsState=b.startState(aM);this.restOfLine="";this.isIncludeFiltered=false;this.isEach=false;this.lastTag="";this.scriptType="";this.isAttrs=false;this.attrsNest=[];this.inAttributeName=true;this.attributeIsType=false;this.attrValue="";this.indentOf=Infinity;this.indentToken="";this.innerMode=null;this.innerState=null;this.innerModeForLine=false}al.prototype.copy=function(){var c=new al();c.javaScriptLine=this.javaScriptLine;c.javaScriptLineExcludesColon=this.javaScriptLineExcludesColon;c.javaScriptArguments=this.javaScriptArguments;c.javaScriptArgumentsDepth=this.javaScriptArgumentsDepth;c.isInterpolating=this.isInterpolating;c.interpolationNesting=this.interpolationNesting;c.jsState=b.copyState(aM,this.jsState);c.innerMode=this.innerMode;if(this.innerMode&&this.innerState){c.innerState=b.copyState(this.innerMode,this.innerState)}c.restOfLine=this.restOfLine;c.isIncludeFiltered=this.isIncludeFiltered;c.isEach=this.isEach;c.lastTag=this.lastTag;c.scriptType=this.scriptType;c.isAttrs=this.isAttrs;c.attrsNest=this.attrsNest.slice();c.inAttributeName=this.inAttributeName;c.attributeIsType=this.attributeIsType;c.attrValue=this.attrValue;c.indentOf=this.indentOf;c.indentToken=this.indentToken;c.innerModeForLine=this.innerModeForLine;return c};function aC(c,d){if(c.sol()){d.javaScriptLine=false;d.javaScriptLineExcludesColon=false}if(d.javaScriptLine){if(d.javaScriptLineExcludesColon&&c.peek()===":"){d.javaScriptLine=false;d.javaScriptLineExcludesColon=false;return}var e=aM.token(c,d.jsState);if(c.eol()){d.javaScriptLine=false}return e||true}}function aD(c,d){if(d.javaScriptArguments){if(d.javaScriptArgumentsDepth===0&&c.peek()!=="("){d.javaScriptArguments=false;return}if(c.peek()==="("){d.javaScriptArgumentsDepth++}else{if(c.peek()===")"){d.javaScriptArgumentsDepth--}}if(d.javaScriptArgumentsDepth===0){d.javaScriptArguments=false;return}var e=aM.token(c,d.jsState);return e||true}}function aU(c){if(c.match(/^yield\b/)){return"keyword"}}function aB(c){if(c.match(/^(?:doctype) *([^\n]+)?/)){return ac}}function aF(c,d){if(c.match("#{")){d.isInterpolating=true;d.interpolationNesting=0;return"punctuation"}}function ag(c,d){if(d.isInterpolating){if(c.peek()==="}"){d.interpolationNesting--;if(d.interpolationNesting<0){c.next();d.isInterpolating=false;return"punctuation"}}else{if(c.peek()==="{"){d.interpolationNesting++}}return aM.token(c,d.jsState)||true}}function aq(c,d){if(c.match(/^case\b/)){d.javaScriptLine=true;return ax}}function ao(c,d){if(c.match(/^when\b/)){d.javaScriptLine=true;d.javaScriptLineExcludesColon=true;return ax}}function aH(c){if(c.match(/^default\b/)){return ax}}function ay(c,d){if(c.match(/^extends?\b/)){d.restOfLine="string";return ax}}function am(c,d){if(c.match(/^append\b/)){d.restOfLine="variable";return ax}}function ak(c,d){if(c.match(/^prepend\b/)){d.restOfLine="variable";return ax}}function aP(c,d){if(c.match(/^block\b *(?:(prepend|append)\b)?/)){d.restOfLine="variable";return ax}}function aX(c,d){if(c.match(/^include\b/)){d.restOfLine="string";return ax}}function ad(c,d){if(c.match(/^include:([a-zA-Z0-9\-]+)/,false)&&c.match("include")){d.isIncludeFiltered=true;return ax}}function aW(c,d){if(d.isIncludeFiltered){var e=ar(c,d);d.isIncludeFiltered=false;d.restOfLine="string";return e}}function ab(c,d){if(c.match(/^mixin\b/)){d.javaScriptLine=true;return ax}}function aV(c,d){if(c.match(/^\+([-\w]+)/)){if(!c.match(/^\( *[-\w]+ *=/,false)){d.javaScriptArguments=true;d.javaScriptArgumentsDepth=0}return"variable"}if(c.match(/^\+#{/,false)){c.next();d.mixinCallAfter=true;return aF(c,d)}}function aJ(c,d){if(d.mixinCallAfter){d.mixinCallAfter=false;if(!c.match(/^\( *[-\w]+ *=/,false)){d.javaScriptArguments=true;d.javaScriptArgumentsDepth=0}return true}}function aE(c,d){if(c.match(/^(if|unless|else if|else)\b/)){d.javaScriptLine=true;return ax}}function ah(c,d){if(c.match(/^(- *)?(each|for)\b/)){d.isEach=true;return ax}}function aR(c,d){if(d.isEach){if(c.match(/^ in\b/)){d.javaScriptLine=true;d.isEach=false;return ax}else{if(c.sol()||c.eol()){d.isEach=false}else{if(c.next()){while(!c.match(/^ in\b/,false)&&c.next()){}return"variable"}}}}}function aN(c,d){if(c.match(/^while\b/)){d.javaScriptLine=true;return ax}}function ai(c,d){var e;if(e=c.match(/^(\w(?:[-:\w]*\w)?)\/?/)){d.lastTag=e[1].toLowerCase();if(d.lastTag==="script"){d.scriptType="application/javascript"}return"tag"}}function ar(c,d){if(c.match(/^:([\w\-]+)/)){var e;if(an&&an.innerModes){e=an.innerModes(c.current().substring(1))}if(!e){e=c.current().substring(1)}if(typeof e==="string"){e=b.getMode(an,e)}aS(c,d,e);return"atom"}}function aT(c,d){if(c.match(/^(!?=|-)/)){d.javaScriptLine=true;return"punctuation"}}function ap(c){if(c.match(/^#([\w-]+)/)){return aA}}function af(c){if(c.match(/^\.([\w-]+)/)){return aG}}function aQ(c,d){if(c.peek()=="("){c.next();d.isAttrs=true;d.attrsNest=[];d.inAttributeName=true;d.attrValue="";d.attributeIsType=false;return"punctuation"}}function az(c,d){if(d.isAttrs){if(aa[c.peek()]){d.attrsNest.push(aa[c.peek()])}if(d.attrsNest[d.attrsNest.length-1]===c.peek()){d.attrsNest.pop()}else{if(c.eat(")")){d.isAttrs=false;return"punctuation"}}if(d.inAttributeName&&c.match(/^[^=,\)!]+/)){if(c.peek()==="="||c.peek()==="!"){d.inAttributeName=false;d.jsState=b.startState(aM);if(d.lastTag==="script"&&c.current().trim().toLowerCase()==="type"){d.attributeIsType=true}else{d.attributeIsType=false}}return"attribute"}var f=aM.token(c,d.jsState);if(d.attributeIsType&&f==="string"){d.scriptType=c.current().toString()}if(d.attrsNest.length===0&&(f==="string"||f==="variable"||f==="keyword")){try{Function("","var x "+d.attrValue.replace(/,\s*$/,"").replace(/^!/,""));d.inAttributeName=true;d.attrValue="";c.backUp(c.current().length);return az(c,d)}catch(e){}}d.attrValue+=c.current();return f||true}}function aI(c,d){if(c.match(/^&attributes\b/)){d.javaScriptArguments=true;d.javaScriptArgumentsDepth=0;return"keyword"}}function aL(c){if(c.sol()&&c.eatSpace()){return"indent"}}function at(c,d){if(c.match(/^ *\/\/(-)?([^\n]*)/)){d.indentOf=c.indentation();d.indentToken="comment";return"comment"}}function av(c){if(c.match(/^: */)){return"colon"}}function aw(c,d){if(c.match(/^(?:\| ?| )([^\n]+)/)){return"string"}if(c.match(/^(<[^\n]*)/,false)){aS(c,d,"htmlmixed");d.innerModeForLine=true;return au(c,d,true)}}function a(c,d){if(c.eat(".")){var e=null;if(d.lastTag==="script"&&d.scriptType.toLowerCase().indexOf("javascript")!=-1){e=d.scriptType.toLowerCase().replace(/"|'/g,"")}else{if(d.lastTag==="style"){e="css"}}aS(c,d,e);return"dot"}}function aO(c){c.next();return null}function aS(c,e,d){d=b.mimeModes[d]||d;d=an.innerModes?an.innerModes(d)||d:d;d=b.mimeModes[d]||d;d=b.getMode(an,d);e.indentOf=c.indentation();if(d&&d.name!=="null"){e.innerMode=d}else{e.indentToken="string"}}function au(c,d,e){if(c.indentation()>d.indentOf||(d.innerModeForLine&&!c.sol())||e){if(d.innerMode){if(!d.innerState){d.innerState=d.innerMode.startState?b.startState(d.innerMode,c.indentation()):{}}return c.hideFirstChars(d.indentOf+2,function(){return d.innerMode.token(c,d.innerState)||true})}else{c.skipToEnd();return d.indentToken}}else{if(c.sol()){d.indentOf=Infinity;d.indentToken=null;d.innerMode=null;d.innerState=null}}}function ae(c,d){if(c.sol()){d.restOfLine=""}if(d.restOfLine){c.skipToEnd();var e=d.restOfLine;d.restOfLine="";return e}}function aj(){return new al()}function aK(c){return c.copy()}function aY(c,d){var e=au(c,d)||ae(c,d)||ag(c,d)||aW(c,d)||aR(c,d)||az(c,d)||aC(c,d)||aD(c,d)||aJ(c,d)||aU(c,d)||aB(c,d)||aF(c,d)||aq(c,d)||ao(c,d)||aH(c,d)||ay(c,d)||am(c,d)||ak(c,d)||aP(c,d)||aX(c,d)||ad(c,d)||ab(c,d)||aV(c,d)||aE(c,d)||ah(c,d)||aN(c,d)||ai(c,d)||ar(c,d)||aT(c,d)||ap(c,d)||af(c,d)||aQ(c,d)||aI(c,d)||aL(c,d)||aw(c,d)||at(c,d)||av(c,d)||a(c,d)||aO(c,d);return e===true?null:e}return{startState:aj,copyState:aK,token:aY}},"javascript","css","htmlmixed");b.defineMIME("text/x-pug","pug");b.defineMIME("text/x-jade","pug")});