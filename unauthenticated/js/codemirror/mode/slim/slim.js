(function(b){if(typeof exports=="object"&&typeof module=="object"){b(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],b)}else{b(CodeMirror)}}})(function(b){b.defineMode("slim",function(an){var aV=b.getMode(an,{name:"htmlmixed"});var aj=b.getMode(an,"ruby");var ab={html:aV,ruby:aj};var aw={ruby:"ruby",javascript:"javascript",css:"text/css",sass:"text/x-sass",scss:"text/x-scss",less:"text/x-less",styl:"text/x-styl",coffee:"coffeescript",asciidoc:"text/x-asciidoc",markdown:"text/x-markdown",textile:"text/x-textile",creole:"text/x-creole",wiki:"text/x-wiki",mediawiki:"text/x-mediawiki",rdoc:"text/x-rdoc",builder:"text/x-builder",nokogiri:"text/x-nokogiri",erb:"application/x-erb"};var aG=function(c){var e=[];for(var d in c){e.push(d)}return new RegExp("^("+e.join("|")+"):")}(aw);var ag={commentLine:"comment",slimSwitch:"operator special",slimTag:"tag",slimId:"attribute def",slimClass:"attribute qualifier",slimAttribute:"attribute",slimSubmode:"keyword special",closeAttributeTag:null,slimDoctype:null,lineContinuation:null};var ao={"{":"}","[":"]","(":")"};var aK="_a-zA-Z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD";var aZ=aK+"\\-0-9\xB7\u0300-\u036F\u203F-\u2040";var ah=new RegExp("^[:"+aK+"](?::["+aZ+"]|["+aZ+"]*)");var aL=new RegExp("^[:"+aK+"][:\\."+aZ+"]*(?=\\s*=)");var aS=new RegExp("^[:"+aK+"][:\\."+aZ+"]*");var ak=/^\.-?[_a-zA-Z]+[\w\-]*/;var am=/^#[_a-zA-Z]+[\w\-]*/;function af(c,d,e){var f=function(g,h){h.tokenize=d;if(g.pos<c){g.pos=c;return e}return h.tokenize(g,h)};return function(g,h){h.tokenize=f;return d(g,h)}}function ar(c,f,h,d,g){var e=c.current();var i=e.search(h);if(i>-1){f.tokenize=af(c.pos,f.tokenize,g);c.backUp(e.length-i-d)}return g}function aI(c,d){c.stack={parent:c.stack,style:"continuation",indented:d,tokenize:c.line};c.line=c.tokenize}function ac(c){if(c.line==c.tokenize){c.line=c.stack.tokenize;c.stack=c.stack.parent}}function au(d,c){return function(e,f){ac(f);if(e.match(/^\\$/)){aI(f,d);return"lineContinuation"}var g=c(e,f);if(e.eol()&&e.current().match(/(?:^|[^\\])(?:\\\\)*\\$/)){e.backUp(1)}return g}}function at(d,c){return function(e,f){ac(f);var g=c(e,f);if(e.eol()&&e.current().match(/,$/)){aI(f,d)}return g}}function aJ(d,c){return function(e,f){var g=e.peek();if(g==d&&f.rubyState.tokenize.length==1){e.next();f.tokenize=c;return"closeAttributeTag"}else{return aB(e,f)}}}function ae(c){var e;var d=function(f,g){if(g.rubyState.tokenize.length==1&&!g.rubyState.context.prev){f.backUp(1);if(f.eatSpace()){g.rubyState=e;g.tokenize=c;return c(f,g)}f.next()}return aB(f,g)};return function(f,g){e=g.rubyState;g.rubyState=b.startState(aj);g.tokenize=d;return aB(f,g)}}function aB(c,d){return aj.token(c,d.rubyState)}function aR(c,d){if(c.match(/^\\$/)){return"lineContinuation"}return az(c,d)}function az(c,d){if(c.match(/^#\{/)){d.tokenize=aJ("}",d.tokenize);return null}return ar(c,d,/[^\\]#\{/,1,aV.token(c,d.htmlState))}function aN(c){return function(d,e){var f=aR(d,e);if(d.eol()){e.tokenize=c}return f}}function aQ(c,e,d){e.stack={parent:e.stack,style:"html",indented:c.column()+d,tokenize:e.line};e.line=e.tokenize=az;return null}function aq(c,d){c.skipToEnd();return d.stack.style}function ax(c,d){d.stack={parent:d.stack,style:"comment",indented:d.indented+1,tokenize:d.line};d.line=aq;return aq(c,d)}function a0(c,d){if(c.eat(d.stack.endQuote)){d.line=d.stack.line;d.tokenize=d.stack.tokenize;d.stack=d.stack.parent;return null}if(c.match(aS)){d.tokenize=ay;return"slimAttribute"}c.next();return null}function ay(c,d){if(c.match(/^==?/)){d.tokenize=aW;return null}return a0(c,d)}function aW(c,d){var e=c.peek();if(e=='"'||e=="'"){d.tokenize=aF(e,"string",true,false,a0);c.next();return d.tokenize(c,d)}if(e=="["){return ae(a0)(c,d)}if(c.match(/^(true|false|nil)\b/)){d.tokenize=a0;return"keyword"}return ae(a0)(c,d)}function ai(d,e,c){d.stack={parent:d.stack,style:"wrapper",indented:d.indented+1,tokenize:c,line:d.line,endQuote:e};d.line=d.tokenize=a0;return null}function aE(c,d){if(c.match(/^#\{/)){d.tokenize=aJ("}",d.tokenize);return null}var e=new b.StringStream(c.string.slice(d.stack.indented),c.tabSize);e.pos=c.pos-d.stack.indented;e.start=c.start-d.stack.indented;e.lastColumnPos=c.lastColumnPos-d.stack.indented;e.lastColumnValue=c.lastColumnValue-d.stack.indented;var f=d.subMode.token(e,d.subState);c.pos=e.pos+d.stack.indented;return f}function aH(c,d){d.stack.indented=c.column();d.line=d.tokenize=aE;return d.tokenize(c,d)}function aA(c){var d=aw[c];var e=b.mimeModes[d];if(e){return b.getMode(an,e)}var f=b.modes[d];if(f){return f(an,{name:d})}return b.getMode(an,"null")}function ap(c){if(!ab.hasOwnProperty(c)){return ab[c]=aA(c)}return ab[c]}function aO(c,d){var f=ap(c);var e=b.startState(f);d.subMode=f;d.subState=e;d.stack={parent:d.stack,style:"sub",indented:d.indented+1,tokenize:d.line};d.line=d.tokenize=aH;return"slimSubmode"}function aC(c,d){c.skipToEnd();return"slimDoctype"}function aD(c,d){var e=c.peek();if(e=="<"){return(d.tokenize=aN(d.tokenize))(c,d)}if(c.match(/^[|']/)){return aQ(c,d,1)}if(c.match(/^\/(!|\[\w+])?/)){return ax(c,d)}if(c.match(/^(-|==?[<>]?)/)){d.tokenize=au(c.column(),at(c.column(),aB));return"slimSwitch"}if(c.match(/^doctype\b/)){d.tokenize=aC;return"keyword"}var f=c.match(aG);if(f){return aO(f[1],d)}return av(c,d)}function aM(c,d){if(d.startOfLine){return aD(c,d)}return av(c,d)}function av(c,d){if(c.eat("*")){d.tokenize=ae(aP);return null}if(c.match(ah)){d.tokenize=aP;return"slimTag"}return ad(c,d)}function aP(c,d){if(c.match(/^(<>?|><?)/)){d.tokenize=ad;return null}return ad(c,d)}function ad(c,d){if(c.match(am)){d.tokenize=ad;return"slimId"}if(c.match(ak)){d.tokenize=ad;return"slimClass"}return aT(c,d)}function aT(c,d){if(c.match(/^([\[\{\(])/)){return ai(d,ao[RegExp.$1],aT)}if(c.match(aL)){d.tokenize=a;return"slimAttribute"}if(c.peek()=="*"){c.next();d.tokenize=ae(aY);return null}return aY(c,d)}function a(c,d){if(c.match(/^==?/)){d.tokenize=al;return null}return aT(c,d)}function al(c,d){var e=c.peek();if(e=='"'||e=="'"){d.tokenize=aF(e,"string",true,false,aT);c.next();return d.tokenize(c,d)}if(e=="["){return ae(aT)(c,d)}if(e==":"){return ae(aX)(c,d)}if(c.match(/^(true|false|nil)\b/)){d.tokenize=aT;return"keyword"}return ae(aT)(c,d)}function aX(c,d){c.backUp(1);if(c.match(/^[^\s],(?=:)/)){d.tokenize=ae(aX);return null}c.next();return aT(c,d)}function aF(g,e,c,d,f){return function(k,h){ac(h);var j=k.current().length==0;if(k.match(/^\\$/,j)){if(!j){return e}aI(h,h.indented);return"lineContinuation"}if(k.match(/^#\{/,j)){if(!j){return e}h.tokenize=aJ("}",h.tokenize);return null}var l=false,i;while((i=k.next())!=null){if(i==g&&(d||!l)){h.tokenize=f;break}if(c&&i=="#"&&!l){if(k.eat("{")){k.backUp(2);break}}l=!l&&i=="\\"}if(k.eol()&&l){k.backUp(1)}return e}}function aY(c,d){if(c.match(/^==?/)){d.tokenize=aB;return"slimSwitch"}if(c.match(/^\/$/)){d.tokenize=aM;return null}if(c.match(/^:/)){d.tokenize=av;return"slimSwitch"}aQ(c,d,0);return d.tokenize(c,d)}var aU={startState:function(){var d=b.startState(aV);var c=b.startState(aj);return{htmlState:d,rubyState:c,stack:null,last:null,tokenize:aM,line:aM,indented:0}},copyState:function(c){return{htmlState:b.copyState(aV,c.htmlState),rubyState:b.copyState(aj,c.rubyState),subMode:c.subMode,subState:c.subMode&&b.copyState(c.subMode,c.subState),stack:c.stack,last:c.last,tokenize:c.tokenize,line:c.line}},token:function(c,d){if(c.sol()){d.indented=c.indentation();d.startOfLine=true;d.tokenize=d.line;while(d.stack&&d.stack.indented>d.indented&&d.last!="slimSubmode"){d.line=d.tokenize=d.stack.tokenize;d.stack=d.stack.parent;d.subMode=null;d.subState=null}}if(c.eatSpace()){return null}var e=d.tokenize(c,d);d.startOfLine=false;if(e){d.last=e}return ag.hasOwnProperty(e)?ag[e]:e},blankLine:function(c){if(c.subMode&&c.subMode.blankLine){return c.subMode.blankLine(c.subState)}},innerMode:function(c){if(c.subMode){return{state:c.subState,mode:c.subMode}}return{state:c,mode:aU}}};return aU},"htmlmixed","ruby");b.defineMIME("text/x-slim","slim");b.defineMIME("application/x-slim","slim")});