(function(b){if(typeof exports=="object"&&typeof module=="object"){b(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],b)}else{b(CodeMirror)}}})(function(b){b.defineMode("ruby",function(z){function D(c){var d={};for(var f=0,e=c.length;f<e;++f){d[c[f]]=true}return d}var u=D(["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"]);var v=D(["def","class","case","for","while","until","module","then","catch","loop","proc","begin"]);var A=D(["end","until"]);var B={"[":"]","{":"}","(":")"};var r;function C(e,c,d){d.tokenize.push(e);return e(c,d)}function y(d,f){if(d.sol()&&d.match("=begin")&&d.eol()){f.tokenize.push(s);return"comment"}if(d.eatSpace()){return null}var g=d.next(),j;if(g=="`"||g=="'"||g=='"'){return C(q(g,"string",g=='"'||g=="`"),d,f)}else{if(g=="/"){if(t(d)){return C(q(g,"string-2",true),d,f)}else{return"operator"}}else{if(g=="%"){var h="string",c=true;if(d.eat("s")){h="atom"}else{if(d.eat(/[WQ]/)){h="string"}else{if(d.eat(/[r]/)){h="string-2"}else{if(d.eat(/[wxq]/)){h="string";c=false}}}}var e=d.eat(/[^\w\s=]/);if(!e){return"operator"}if(B.propertyIsEnumerable(e)){e=B[e]}return C(q(e,h,c,true),d,f)}else{if(g=="#"){d.skipToEnd();return"comment"}else{if(g=="<"&&(j=d.match(/^<-?[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/))){return C(w(j[1]),d,f)}else{if(g=="0"){if(d.eat("x")){d.eatWhile(/[\da-fA-F]/)}else{if(d.eat("b")){d.eatWhile(/[01]/)}else{d.eatWhile(/[0-7]/)}}return"number"}else{if(/\d/.test(g)){d.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/);return"number"}else{if(g=="?"){while(d.match(/^\\[CM]-/)){}if(d.eat("\\")){d.eatWhile(/\w/)}else{d.next()}return"string"}else{if(g==":"){if(d.eat("'")){return C(q("'","atom",false),d,f)}if(d.eat('"')){return C(q('"',"atom",true),d,f)}if(d.eat(/[\<\>]/)){d.eat(/[\<\>]/);return"atom"}if(d.eat(/[\+\-\*\/\&\|\:\!]/)){return"atom"}if(d.eat(/[a-zA-Z$@_\xa1-\uffff]/)){d.eatWhile(/[\w$\xa1-\uffff]/);d.eat(/[\?\!\=]/);return"atom"}return"operator"}else{if(g=="@"&&d.match(/^@?[a-zA-Z_\xa1-\uffff]/)){d.eat("@");d.eatWhile(/[\w\xa1-\uffff]/);return"variable-2"}else{if(g=="$"){if(d.eat(/[a-zA-Z_]/)){d.eatWhile(/[\w]/)}else{if(d.eat(/\d/)){d.eat(/\d/)}else{d.next()}}return"variable-3"}else{if(/[a-zA-Z_\xa1-\uffff]/.test(g)){d.eatWhile(/[\w\xa1-\uffff]/);d.eat(/[\?\!]/);if(d.eat(":")){return"atom"}return"ident"}else{if(g=="|"&&(f.varList||f.lastTok=="{"||f.lastTok=="do")){r="|";return null}else{if(/[\(\)\[\]{}\\;]/.test(g)){r=g;return null}else{if(g=="-"&&d.eat(">")){return"arrow"}else{if(/[=+\-\/*:\.^%<>~|]/.test(g)){var i=d.eatWhile(/[=+\-\/*:\.^%<>~|]/);if(g=="."&&!i){r="."}return"operator"}else{return null}}}}}}}}}}}}}}}}}function t(d){var c=d.pos,e=0,h,g=false,f=false;while((h=d.next())!=null){if(!f){if("[{(".indexOf(h)>-1){e++}else{if("]})".indexOf(h)>-1){e--;if(e<0){break}}else{if(h=="/"&&e==0){g=true;break}}}f=h=="\\"}else{f=false}}d.backUp(d.pos-c);return g}function a(c){if(!c){c=1}return function(d,e){if(d.peek()=="}"){if(c==1){e.tokenize.pop();return e.tokenize[e.tokenize.length-1](d,e)}else{e.tokenize[e.tokenize.length-1]=a(c-1)}}else{if(d.peek()=="{"){e.tokenize[e.tokenize.length-1]=a(c+1)}}return y(d,e)}}function x(){var c=false;return function(d,e){if(c){e.tokenize.pop();return e.tokenize[e.tokenize.length-1](d,e)}c=true;return y(d,e)}}function q(f,e,c,d){return function(g,i){var h=false,j;if(i.context.type==="read-quoted-paused"){i.context=i.context.prev;g.eat("}")}while((j=g.next())!=null){if(j==f&&(d||!h)){i.tokenize.pop();break}if(c&&j=="#"&&!h){if(g.eat("{")){if(f=="}"){i.context={prev:i.context,type:"read-quoted-paused"}}i.tokenize.push(a());break}else{if(/[@\$]/.test(g.peek())){i.tokenize.push(x());break}}}h=!h&&j=="\\"}return e}}function w(c){return function(d,e){if(d.match(c)){e.tokenize.pop()}else{d.skipToEnd()}return"string"}}function s(c,d){if(c.sol()&&c.match("=end")&&c.eol()){d.tokenize.pop()}c.skipToEnd();return"comment"}return{startState:function(){return{tokenize:[y],indented:0,context:{type:"top",indented:-z.indentUnit},continuedLine:false,lastTok:null,varList:false}},token:function(c,f){r=null;if(c.sol()){f.indented=c.indentation()}var g=f.tokenize[f.tokenize.length-1](c,f),d;var h=r;if(g=="ident"){var e=c.current();g=f.lastTok=="."?"property":u.propertyIsEnumerable(c.current())?"keyword":/^[A-Z]/.test(e)?"tag":(f.lastTok=="def"||f.lastTok=="class"||f.varList)?"def":"variable";if(g=="keyword"){h=e;if(v.propertyIsEnumerable(e)){d="indent"}else{if(A.propertyIsEnumerable(e)){d="dedent"}else{if((e=="if"||e=="unless")&&c.column()==c.indentation()){d="indent"}else{if(e=="do"&&f.context.indented<f.indented){d="indent"}}}}}}if(r||(g&&g!="comment")){f.lastTok=h}if(r=="|"){f.varList=!f.varList}if(d=="indent"||/[\(\[\{]/.test(r)){f.context={prev:f.context,type:r||g,indented:f.indented}}else{if((d=="dedent"||/[\)\]\}]/.test(r))&&f.context.prev){f.context=f.context.prev}}if(c.eol()){f.continuedLine=(r=="\\"||g=="operator")}return g},indent:function(c,g){if(c.tokenize[c.tokenize.length-1]!=y){return 0}var d=g&&g.charAt(0);var e=c.context;var f=e.type==B[d]||e.type=="keyword"&&/^(?:end|until|else|elsif|when|rescue)\b/.test(g);return e.indented+(f?0:z.indentUnit)+(c.continuedLine?z.indentUnit:0)},electricInput:/^\s*(?:end|rescue|elsif|else|\})$/,lineComment:"#"}});b.defineMIME("text/x-ruby","ruby")});